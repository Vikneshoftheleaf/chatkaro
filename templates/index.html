<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChatKaroo | Talk to a Virtual Characters</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
</head>

<body class="flex justify-center relative font-poppins">

  <main class="h-screen lg:w-[60%] w-full p-4 relative">
    <div class="p-4 flex gap-2 items-center">
      <h1 class="text-xl font-bold p-4">ChatKaroo (Beta) </h1> 
      <span id="status"></span>
    </div>
    <div id="chat-log" class="chat-log overflow-y-scroll lg:h-[70%] h-[75%] w-full ">
    </div>
    <div class="w-full flex justify-center items-center  ">
      <div class="flex w-[88%] border rounded-full bg-gray-100 overflow-hidden shadow-sm">
        <input type="text" id="message-input" placeholder="Message"
          class="w-[70%] lg:w-[80%] px-6 py-3 bg-gray-100 focus:outline-none ">
        <button id="send-button" class="w-[30%] lg:w-[20%] flex justify-end px-4 items-center">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="h-10 w-10 bi bi-arrow-right-circle-fill"
            viewBox="0 0 16 16">
            <path
              d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z" />
          </svg>
        </button>
      </div>
    </div>
  </main>





  <script>
    const chatLogElement = document.getElementById("chat-log");
    const messageInputElement = document.getElementById("message-input");
    const sendButtonElement = document.getElementById("send-button");
    const status = document.getElementById("status");

    let log = [


    ];

    function typeText(elementId, text, speed) {
      const element = document.getElementById(elementId);
      let index = 0;

      function type() {
        if (index < text.length) {
          element.textContent += text.charAt(index);
          index++;
          setTimeout(type, speed);
        }
      }

      type();
    }

    const prompt = [{
      role: "user",
      content: "The response should be short in length and should sound more human, Roleplay like You are Taylor Swift, one of the most iconic and influential pop stars in the world. Right now, you’re in a quaint, hidden-away coffee shop, a place you like to visit when you need a break from the whirlwind of fame and your intense schedule. Dressed down in casual clothes—an oversized sweater, a baseball cap, and sunglasses—you’re trying to stay unnoticed as you sip your latte and enjoy some quiet time. Despite your efforts to remain incognito, someone has recognized you. Initially cautious, you’re polite and kind, knowing how much your fans mean to you, but you also value your privacy. As the conversation begins, you keep things light and casual, talking about music, songwriting, and the simple joys of life away from the spotlight. You love connecting with people on a genuine level, but you’re also careful not to overshare about your personal life or the pressures of fame. Gradually, if the person respects your boundaries, you’ll open up a bit more, showing your witty, thoughtful side while maintaining a calm, grounded presence. You want the interaction to feel genuine, where you can be Taylor, the person, not just the superstar."
    }]

    // Function to render chat log to the screen
    function renderChatLog() {
      chatLogElement.innerHTML = ''; // Clear the previous entries
      log.forEach((entry, index) => {
        const li = document.createElement("div");
        if (entry.role == "user") {

          li.innerHTML = `<div class="w-full flex justify-end p-4  text-black"><p class=" w-[60%] bg-blue-100 rounded-lg p-4 text-base">${entry.content}</p></div>`;
        }
        else {

          li.innerHTML = `<div class="w-full flex justify-start p-4  text-black"><img src="/static/taylor.jpeg" alt="Taylor Swift" class="h-8 w-8 rounded-full mx-4 object-cover"><p class="w-[80%] bg-gray-100 rounded-lg p-4 text-base">${entry.content}</p></div>`;
        }
        chatLogElement.appendChild(li);
        chatLogElement.scrollTop = chatLogElement.scrollHeight;
      });
    }

    // Function to send data to the Flask API
    async function sendData(data) {
      status.innerHTML = '<p class="px-4 py-2 bg-blue-100 text-blue-950 rounded-md font-semibold text-sm"> Loading</p>'
      const url = 'https://chatkaroo.vercel.app/gen'; // Your Flask API endpoint

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data) // Send the log array as JSON
        });

        if (response.ok) {
          const result = await response.json();
          log.push(result); // Append the new result to the log
          renderChatLog(); // Re-render the chat log
          status.textContent = ""

        } else {
          console.error('Error:', response.statusText);
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // Send button click event
    sendButtonElement.addEventListener("click", () => {
      const newMessage = messageInputElement.value;
      if (newMessage) {
        log.push({
          role: "user",
          content: newMessage
        }); // Add the user's message to the log
        renderChatLog(); // Re-render the chat log
        messageInputElement.value = ''; // Clear the input field

        // Send the updated log to the server

        sendData(log);
      }
    });

    // Initial render of chat log
    sendData(prompt)
    renderChatLog();
  </script>

</body>

</html>